<meta charset="utf-8">

<head>
	<title> Prototype 1 </title>
</head>
<body>


<canvas id="canvas" width='700px' height='50px' style="border: 2px solid black">

	<p>Your computer doesn't support the canvas tag</p>
</canvas>
<br>
<canvas id="canvasExp" width='700px' height='16px'>

	<p>Your computer doesn't support the canvas tag</p>
</canvas>

<br><br>


<button type="button" onclick="healSkill();">Heal!</button>
<button type="button" onclick="ataqueJogador(5);">Power Attack</button>

<INPUT TYPE="SUBMIT" VALUE=" Ultimate " class="FORMBUTTON" ID="create_button" onclick="disable();">

<button type="button" onclick="compraDano(1);">+1 Auto attack</button>
<br>



</body>

<canvas id="canvasMapa" width= '700px' height='300px' style='border: 2px solid black'> </canvas>
<br>

<canvas id="canvasInimigo" width='700px' height='50px' style="border: 2px solid black">
</canvas>

<p><button onclick="saveGame()" style="background: #ccc url(triangular.png); padding: 0.2em 2em"">Save</button></p>
     <p><button onclick="loadGame()" style="background: #ccc url(triangular.png); padding: 0.2em 2em"">Load</button></p>


<script>

/* Get the canvas element */
	var c = document.getElementById('canvas');
	var cInimigo = document.getElementById('canvasInimigo');
	var cExp = document.getElementById('canvasExp');
	var cMapa = document.getElementById('canvasMapa');


/* Get the canvas' context */
	var ctx = c.getContext('2d');
	var ctxInimigo = cInimigo.getContext('2d');
	var ctxExp = cExp.getContext('2d');
	var ctxMapa = cMapa.getContext('2d');

/* Variables used for bar fill */
	var total = 1000,
		hatched = 1000;

	var totalInimigo = 200,
		hatchedInimigo = 200;

	var totalExp = 1000;
		hatchedExp = 0;

function desenhaCirculo(x, y, raio) {

        ctxMapa.fillStyle = 'black';
        ctxMapa.beginPath();
        ctxMapa.arc(x, y, raio, 0, 2 * Math.PI);
        ctxMapa.fill();
    }

var level_jogador = 1;


var x = 10;
var y = 10;

var esquerda = 37
var cima = 38
var direita = 39
var baixo = 40

var taxa = 10;

function limpaTela() {

        ctxMapa.clearRect(0, 0, 700, 300);
    }

function atualizaTela() {

        limpaTela();
        desenhaCirculo(x, y, 3);
    }

setInterval(atualizaTela, 20);

function leDoTeclado(evento) {

        if(evento.keyCode == cima) {

            y = y - taxa;

        } else if (evento.keyCode == baixo) {

            y = y + taxa;

        } else if (evento.keyCode == esquerda) {

            x = x - taxa;

        } else if (evento.keyCode == direita) {

            x = x + taxa;
        }
    }


document.onkeydown = leDoTeclado; 





nomeInimigo = 1;

window.onload = refresh();

function refresh() {

	// Jogador 
	
	/* Fill Rectangle*/
	var perc = hatched / total;
	/* ... and filled takes perc and multiplies it by canvas.width (700px in this case) */
	var filled;
	filled = perc * c.width;
	
	ctx.clearRect(0,0,c.width,c.height);

	/* Fill Rectangle*/
	ctx.fillStyle = "#FF0000";
	ctx.fillRect(0,0,filled,c.height);

	/* Fill text */
	ctx.fillStyle = '#000000';
	ctx.font = "30px Arial";
	var text = 'Player ' + Math.round(hatched) + '/' + Math.round(total);
	ctx.fillText(text,225,35);


	// Inimigos

	var percInimigo = hatchedInimigo / totalInimigo;
	/* ... and filled takes perc and multiplies it by canvas.width (700px in this case) */
	var filledInimigo;
	filledInimigo = percInimigo * cInimigo.width;
	
	ctxInimigo.clearRect(0,0,cInimigo.width,cInimigo.height);

	/* Fill Rectangle*/
	ctxInimigo.fillStyle = "#FF0000";
	ctxInimigo.fillRect(0,0,filledInimigo,cInimigo.height);

	/* Fill text */
	ctxInimigo.fillStyle = '#000000';
	ctxInimigo.font = "30px Arial";
	var textInimigo = 'Enemy '+ nomeInimigo + ":    " + Math.round(hatchedInimigo) + '/' + Math.round(totalInimigo);
	ctxInimigo.fillText(textInimigo,195, 35);


	// Exp

	/* Fill Rectangle*/
	var percExp = hatchedExp / totalExp;
	/* ... and filled takes perc and multiplies it by canvas.width (700px in this case) */
	var filledExp;
	filledExp = percExp * 600;
	
	ctxExp.clearRect(0,0,600,cExp.height);

	/* Fill Rectangle*/
	ctxExp.fillStyle = "gold";
	ctxExp.fillRect(0,0,filledExp,cExp.height);

	/* Fill text */
	ctxExp.fillStyle = '#000000';
	ctxExp.font = "12px Arial";
	var textExp = 'ExperiÃªncia ' + Math.round(hatchedExp) + '/' + Math.round(totalExp);
	ctxExp.fillText(textExp, 225, 15);

	ctxExp.fillStyle = '#000000';
	ctxExp.font = "12px Arial";
	var textExp = 'Level: ' + level_jogador;
	ctxExp.clearRect(610, 0, 700, 15);
	ctxExp.fillText(textExp, 610, 15);


}

setInterval(refresh, 100);


var ataqueJogadorAuto = 2;
var ataqueInimigoAuto = 1;


setInterval(function () {ataqueJogador(ataqueJogadorAuto);}, 1000);
setInterval(function() {ataqueInimigo(ataqueInimigoAuto);}, 1000);


function compraDano(x) {

	if (hatchedExp >= 1000) {

		hatchedExp -= 1000;
		ataqueJogadorAuto += 1;

	} else { 

		alert("Not enough EXP");
	}
}

function healSkill () {
	hatched += 100;
	if (hatched >= total) {

		hatched = total;
	}
	refresh();
	
}


function ataqueJogador (x) {
	hatchedInimigo -= ((Math.random() * 10) + 1) * x;

	if (hatchedInimigo <= 0) {
		hatchedInimigo = 0;
	}
	
	if (hatchedInimigo == 0) {

		totalInimigo = totalInimigo * 1.107;
		hatchedInimigo = totalInimigo;
		ganharEXP(100);
		nomeInimigo++;
		ataqueInimigoAuto = ataqueInimigoAuto * 1.04;
		refresh();

	}
}




function ataqueInimigo (x) {
	hatched -= Math.random() * 10 * x;


	if (hatched <= 0) {
		hatched = total;
		
	}
	
}

function ganharEXP(x) {

	hatchedExp = hatchedExp + x;

	if (hatchedExp >= totalExp)	{

		level_jogador++;
		totalExp = 1000 + totalExp * 1.10;

	}

}

function dano(x) {

	hatchedInimigo = hatchedInimigo - x;

	if (hatchedInimigo <= 0) {
		hatchedInimigo = 0;
	}

	refresh();

}

function disable() {
        x=document.getElementById("create_button");
        x.disabled=true;
        x.value="Dragon's Punch!";
        setTimeout(enable, 5000);
        ataqueJogador(7);
        refresh();
    }


function enable() {
        x.disabled=false;
        x.value=" Ultimate ";
    }


function saveGame(){
	game.total = total; 
	game.totalInimigo = totalInimigo;
	game.totalExp = totalExp;
	game.hatched = hatched;

    alert("Saved.");
    localStorage['shittyInc_save'] = btoa(JSON.stringify(game));
}

 function loadGame() {

    var save_data = localStorage['shittyInc_save']
    alert("Loaded.");
    console.log(save_data);
    if (!save_data) return;
    console.log(save_data);

    game = JSON.parse(atob(localStorage['shittyInc_save']))
    total =  game.total;
	totalInimigo = game.totalInimigo;
	totalExp = game.totalExp;
	hatched = game.hatched;

}

var game = {

	total : 0,
	totalInimigo : 0,	
	totalExp : 0, 
	hatched : 0 

}







</script>
